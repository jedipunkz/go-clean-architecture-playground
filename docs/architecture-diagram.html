<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Go クリーンアーキテクチャ構成図</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            margin-bottom: 30px;
        }
        h2 {
            color: #34495e;
            border-bottom: 2px solid #3498db;
            padding-bottom: 10px;
            margin-top: 40px;
        }
        .diagram {
            margin: 30px 0;
            text-align: center;
        }
        .description {
            background-color: #ecf0f1;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        .layer-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .layer-card {
            background-color: #fff;
            padding: 20px;
            border-radius: 8px;
            border-left: 4px solid #3498db;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .layer-card h3 {
            margin-top: 0;
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Go クリーンアーキテクチャ構成図</h1>
        
        <div class="description">
            <p>この図は、Go言語で実装したクリーンアーキテクチャのユーザー管理システムの構成を示しています。</p>
            <p>各層は明確な責任を持ち、依存関係が内側の層（Entity）に向かって一方向に流れるように設計されています。</p>
        </div>

        <h2>システム全体構成図</h2>
        <div class="diagram">
            <div class="mermaid">
graph TB
    subgraph "外部"
        Client[HTTPクライアント<br/>🌐]
    end
    
    subgraph "Interface Layer（インターフェース層）"
        Controller[UserController<br/>📡 HTTP Handler]
        RepoInterface[UserRepository<br/>📋 Interface]
    end
    
    subgraph "Use Case Layer（ユースケース層）"
        UseCase[UserUsecase<br/>⚙️ ビジネスロジック]
    end
    
    subgraph "Entity Layer（エンティティ層）"
        Entity[User Entity<br/>👤 ビジネスルール]
    end
    
    subgraph "Infrastructure Layer（インフラ層）"
        Repository[MemoryUserRepository<br/>💾 データ永続化]
    end
    
    subgraph "Main（依存性注入）"
        Main[main.go<br/>🔧 DI Container]
    end

    Client --> Controller
    Controller --> UseCase
    UseCase --> RepoInterface
    UseCase --> Entity
    Repository -.-> RepoInterface
    Main --> Controller
    Main --> UseCase
    Main --> Repository

    classDef entity fill:#e1f5fe,stroke:#0277bd,stroke-width:2px
    classDef usecase fill:#f3e5f5,stroke:#7b1fa2,stroke-width:2px
    classDef interface fill:#e8f5e8,stroke:#2e7d32,stroke-width:2px
    classDef infrastructure fill:#fff3e0,stroke:#f57c00,stroke-width:2px
    classDef main fill:#fce4ec,stroke:#c2185b,stroke-width:2px
    classDef external fill:#f0f0f0,stroke:#616161,stroke-width:2px

    class Entity entity
    class UseCase usecase
    class Controller,RepoInterface interface
    class Repository infrastructure
    class Main main
    class Client external
            </div>
        </div>

        <h2>依存関係の方向</h2>
        <div class="diagram">
            <div class="mermaid">
graph LR
    Infrastructure[Infrastructure<br/>🏗️ インフラ層] --> Interface[Interface<br/>🔌 インターフェース層]
    Interface --> UseCase[Use Case<br/>⚙️ ユースケース層]
    UseCase --> Entity[Entity<br/>👤 エンティティ層]
    Main[Main<br/>🔧 DI] --> Infrastructure
    Main --> Interface
    Main --> UseCase

    classDef layer fill:#f9f9f9,stroke:#333,stroke-width:3px,color:#333
    class Infrastructure,Interface,UseCase,Entity,Main layer
            </div>
        </div>

        <h2>データフロー図</h2>
        <div class="diagram">
            <div class="mermaid">
sequenceDiagram
    participant C as Client
    participant Ctrl as UserController
    participant UC as UserUsecase
    participant E as User Entity
    participant R as UserRepository

    C->>Ctrl: POST /users
    Ctrl->>UC: CreateUser(name, email)
    UC->>E: NewUser(name, email)
    E-->>UC: User entity
    UC->>R: Create(user)
    R-->>UC: Success
    UC-->>Ctrl: Created user
    Ctrl-->>C: JSON response
            </div>
        </div>

        <div class="layer-info">
            <div class="layer-card">
                <h3>🏗️ Infrastructure Layer</h3>
                <p><strong>責任</strong>: 外部システムとの実際の接続</p>
                <p><strong>実装</strong>: MemoryUserRepository</p>
                <p><strong>特徴</strong>: データベース、API、ファイルシステムなどの具体的な実装</p>
            </div>
            
            <div class="layer-card">
                <h3>🔌 Interface Layer</h3>
                <p><strong>責任</strong>: 外部との入出力インターフェース</p>
                <p><strong>実装</strong>: UserController, UserRepository Interface</p>
                <p><strong>特徴</strong>: HTTP ハンドラーとリポジトリインターフェース</p>
            </div>
            
            <div class="layer-card">
                <h3>⚙️ Use Case Layer</h3>
                <p><strong>責任</strong>: アプリケーション固有のビジネスルール</p>
                <p><strong>実装</strong>: UserUsecase</p>
                <p><strong>特徴</strong>: ユーザー作成、更新、削除などの業務フロー</p>
            </div>
            
            <div class="layer-card">
                <h3>👤 Entity Layer</h3>
                <p><strong>責任</strong>: 核となるビジネスエンティティとルール</p>
                <p><strong>実装</strong>: User Entity</p>
                <p><strong>特徴</strong>: 最も内側で、他に依存しない純粋なビジネスロジック</p>
            </div>
        </div>

        <div class="description">
            <h3>🔗 依存関係逆転の原則</h3>
            <p>従来のアーキテクチャでは上位層が下位層に依存しますが、クリーンアーキテクチャでは：</p>
            <ul>
                <li><strong>インターフェースの活用</strong>: UseCase は Repository インターフェースに依存</li>
                <li><strong>具象への非依存</strong>: UseCase は具体的な Repository 実装を知らない</li>
                <li><strong>DI による結合</strong>: main.go で実際の実装を注入</li>
            </ul>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            themeVariables: {
                primaryColor: '#3498db',
                primaryTextColor: '#2c3e50',
                primaryBorderColor: '#2980b9',
                lineColor: '#34495e',
                secondaryColor: '#ecf0f1',
                tertiaryColor: '#f8f9fa'
            }
        });
    </script>
</body>
</html>